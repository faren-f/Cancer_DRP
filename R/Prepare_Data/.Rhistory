GE = GE[,intersect_genes]
Cancer_i = Cancer_i[,intersect_genes]
TT = c(TT,rep(i,nrow(Cancer_i)))
TCGA_GE = rbind(TCGA_GE,Cancer_i)
}
i="COADREAD"
Cancers = c("ACC","BLCA","BRCA","CESC","COAD","DLBC",
"ESCA","GBM","GBMLGG","HNSC","KICH","KIPAN","KIRC","KIRP",
"LAML","LGG","LIHC","LUAD","LUSC","MESO","OV","PAAD","PCPG",
"PRAD","READ","SARC","SKCM","STAD","STES","TGCT","THCA","THYM",
"UCEC","UCS","UVM")
TCGA_GE = c()
TT = c()
for (i in Cancers){
print(i)
Cancer_i = get(i)
Cancer_i = Cancer_i[-2,]
patient_all = Cancer_i[1,]
patient_all = substr(Cancer_i[1,],1,12)
Cancer_i[1,] = patient_all
patient_with_response = Response_table[which(Response_table$Cancer_type == i),2]
Intersect = intersect(patient_all, patient_with_response)
patient_with_response = Response_table[Response_table$bcr_patient_barcode %in% Intersect,]
Cancer_i = Cancer_i[,c(1,which(patient_all %in% Intersect))]
dup = which(duplicated(as.character(Cancer_i[1,])))
dup = dup-1
colnames(Cancer_i) = Cancer_i[1,]
Cancer_i = Cancer_i[-1,]
rownames(Cancer_i) = Cancer_i[,1]
Cancer_i = Cancer_i[,c(-1)]
Cancer_i = t(Cancer_i)
#B = data.frame((rownames(Cancer_i)))
Cancer_i_2 = apply(Cancer_i,2,as.numeric)
for (k in dup){
rep = apply(Cancer_i_2[c(k-1,k),],2,mean)
Cancer_i_2[k-1,] = rep
}
Cancer_i_2 = Cancer_i_2[-dup,]
Cancer_i = Cancer_i[-dup,]
rownames(Cancer_i_2) = rownames(Cancer_i)
colnames(Cancer_i_2) = colnames(Cancer_i)
Cancer_i = Cancer_i_2
col = colnames(Cancer_i)
col = sapply(strsplit(col,"\\|"),FUN = function(x){return(x[1])})
colnames(Cancer_i) = col
Cancer_i = log2(Cancer_i + 1)
GE = readRDS("Processed_data/S1/expresion_matrix.rds")
intersect_genes = intersect(colnames(GE),colnames(Cancer_i))
GE = GE[,intersect_genes]
Cancer_i = Cancer_i[,intersect_genes]
TT = c(TT,rep(i,nrow(Cancer_i)))
TCGA_GE = rbind(TCGA_GE,Cancer_i)
}
unique(Response_table$Cancer_type)
Cancers = c("ACC","BLCA","BRCA","CESC","COAD","ESCA","GBM",
"HNSC","KICH","KIRC","KIRP","LGG","LIHC","LUAD",
"LUSC","MESO","OV","PAAD","PCPG","PRAD","READ",
"SARC","SKCM","STAD","TGCT","THCA","UCEC","UCS")
TCGA_GE = c()
TT = c()
for (i in Cancers){
print(i)
Cancer_i = get(i)
Cancer_i = Cancer_i[-2,]
patient_all = Cancer_i[1,]
patient_all = substr(Cancer_i[1,],1,12)
Cancer_i[1,] = patient_all
patient_with_response = Response_table[which(Response_table$Cancer_type == i),2]
Intersect = intersect(patient_all, patient_with_response)
patient_with_response = Response_table[Response_table$bcr_patient_barcode %in% Intersect,]
Cancer_i = Cancer_i[,c(1,which(patient_all %in% Intersect))]
dup = which(duplicated(as.character(Cancer_i[1,])))
dup = dup-1
colnames(Cancer_i) = Cancer_i[1,]
Cancer_i = Cancer_i[-1,]
rownames(Cancer_i) = Cancer_i[,1]
Cancer_i = Cancer_i[,c(-1)]
Cancer_i = t(Cancer_i)
#B = data.frame((rownames(Cancer_i)))
Cancer_i_2 = apply(Cancer_i,2,as.numeric)
for (k in dup){
rep = apply(Cancer_i_2[c(k-1,k),],2,mean)
Cancer_i_2[k-1,] = rep
}
Cancer_i_2 = Cancer_i_2[-dup,]
Cancer_i = Cancer_i[-dup,]
rownames(Cancer_i_2) = rownames(Cancer_i)
colnames(Cancer_i_2) = colnames(Cancer_i)
Cancer_i = Cancer_i_2
col = colnames(Cancer_i)
col = sapply(strsplit(col,"\\|"),FUN = function(x){return(x[1])})
colnames(Cancer_i) = col
Cancer_i = log2(Cancer_i + 1)
GE = readRDS("Processed_data/S1/expresion_matrix.rds")
intersect_genes = intersect(colnames(GE),colnames(Cancer_i))
GE = GE[,intersect_genes]
Cancer_i = Cancer_i[,intersect_genes]
TT = c(TT,rep(i,nrow(Cancer_i)))
TCGA_GE = rbind(TCGA_GE,Cancer_i)
}
a = rownames(Cancer_i)
dim(Cancer_i)
i
print(i)
Cancer_i = get(i)
Cancer_i = Cancer_i[-2,]
View(Cancer_i)
patient_all = Cancer_i[1,]
patient_all = substr(Cancer_i[1,],1,12)
Cancer_i[1,] = patient_all
patient_with_response = Response_table[which(Response_table$Cancer_type == i),2]
patient_with_response
Intersect = intersect(patient_all, patient_with_response)
Cancers = c("ACC","BLCA","BRCA","CESC","COAD","ESCA",
"HNSC","KICH","KIRC","KIRP","LGG","LIHC","LUAD",
"LUSC","MESO","OV","PAAD","PCPG","PRAD","READ",
"SARC","SKCM","STAD","TGCT","THCA","UCEC","UCS")
TCGA_GE = c()
TT = c()
for (i in Cancers){
print(i)
Cancer_i = get(i)
Cancer_i = Cancer_i[-2,]
patient_all = Cancer_i[1,]
patient_all = substr(Cancer_i[1,],1,12)
Cancer_i[1,] = patient_all
patient_with_response = Response_table[which(Response_table$Cancer_type == i),2]
Intersect = intersect(patient_all, patient_with_response)
patient_with_response = Response_table[Response_table$bcr_patient_barcode %in% Intersect,]
Cancer_i = Cancer_i[,c(1,which(patient_all %in% Intersect))]
dup = which(duplicated(as.character(Cancer_i[1,])))
dup = dup-1
colnames(Cancer_i) = Cancer_i[1,]
Cancer_i = Cancer_i[-1,]
rownames(Cancer_i) = Cancer_i[,1]
Cancer_i = Cancer_i[,c(-1)]
Cancer_i = t(Cancer_i)
#B = data.frame((rownames(Cancer_i)))
Cancer_i_2 = apply(Cancer_i,2,as.numeric)
for (k in dup){
rep = apply(Cancer_i_2[c(k-1,k),],2,mean)
Cancer_i_2[k-1,] = rep
}
Cancer_i_2 = Cancer_i_2[-dup,]
Cancer_i = Cancer_i[-dup,]
rownames(Cancer_i_2) = rownames(Cancer_i)
colnames(Cancer_i_2) = colnames(Cancer_i)
Cancer_i = Cancer_i_2
col = colnames(Cancer_i)
col = sapply(strsplit(col,"\\|"),FUN = function(x){return(x[1])})
colnames(Cancer_i) = col
Cancer_i = log2(Cancer_i + 1)
GE = readRDS("Processed_data/S1/expresion_matrix.rds")
intersect_genes = intersect(colnames(GE),colnames(Cancer_i))
GE = GE[,intersect_genes]
Cancer_i = Cancer_i[,intersect_genes]
TT = c(TT,rep(i,nrow(Cancer_i)))
TCGA_GE = rbind(TCGA_GE,Cancer_i)
}
i
print(i)
Cancer_i = get(i)
Cancer_i = Cancer_i[-2,]
patient_all = Cancer_i[1,]
patient_all = substr(Cancer_i[1,],1,12)
Cancer_i[1,] = patient_all
View(Cancer_i)
patient_with_response = Response_table[which(Response_table$Cancer_type == i),2]
Intersect = intersect(patient_all, patient_with_response)
patient_with_response
patient_with_response = Response_table[Response_table$bcr_patient_barcode %in% Intersect,]
View(patient_with_response)
Cancer_i = Cancer_i[,c(1,which(patient_all %in% Intersect))]
View(Cancer_i)
dup = which(duplicated(as.character(Cancer_i[1,])))
dup
dup = dup-1
colnames(Cancer_i) = Cancer_i[1,]
Cancer_i = Cancer_i[-1,]
rownames(Cancer_i) = Cancer_i[,1]
Cancer_i = Cancer_i[,c(-1)]
Cancer_i = t(Cancer_i)
dup
#B = data.frame((rownames(Cancer_i)))
Cancer_i_2 = apply(Cancer_i,2,as.numeric)
for (k in dup){
rep = apply(Cancer_i_2[c(k-1,k),],2,mean)
Cancer_i_2[k-1,] = rep
}
Cancer_i_2 = Cancer_i_2[-dup,]
Cancer_i = Cancer_i[-dup,]
rownames(Cancer_i_2) = rownames(Cancer_i)
colnames(Cancer_i_2) = colnames(Cancer_i)
Cancer_i = Cancer_i_2
col = colnames(Cancer_i)
col
i
Cancers = c("ACC","BLCA","BRCA","CESC","COAD","ESCA",
"HNSC","KIRC","KIRP","LGG","LIHC","LUAD",
"LUSC","MESO","OV","PAAD","PCPG","PRAD","READ",
"SARC","SKCM","STAD","TGCT","THCA","UCEC","UCS")
TCGA_GE = c()
TT = c()
for (i in Cancers){
print(i)
Cancer_i = get(i)
Cancer_i = Cancer_i[-2,]
patient_all = Cancer_i[1,]
patient_all = substr(Cancer_i[1,],1,12)
Cancer_i[1,] = patient_all
patient_with_response = Response_table[which(Response_table$Cancer_type == i),2]
Intersect = intersect(patient_all, patient_with_response)
patient_with_response = Response_table[Response_table$bcr_patient_barcode %in% Intersect,]
Cancer_i = Cancer_i[,c(1,which(patient_all %in% Intersect))]
dup = which(duplicated(as.character(Cancer_i[1,])))
dup = dup-1
colnames(Cancer_i) = Cancer_i[1,]
Cancer_i = Cancer_i[-1,]
rownames(Cancer_i) = Cancer_i[,1]
Cancer_i = Cancer_i[,c(-1)]
Cancer_i = t(Cancer_i)
#B = data.frame((rownames(Cancer_i)))
Cancer_i_2 = apply(Cancer_i,2,as.numeric)
for (k in dup){
rep = apply(Cancer_i_2[c(k-1,k),],2,mean)
Cancer_i_2[k-1,] = rep
}
Cancer_i_2 = Cancer_i_2[-dup,]
Cancer_i = Cancer_i[-dup,]
rownames(Cancer_i_2) = rownames(Cancer_i)
colnames(Cancer_i_2) = colnames(Cancer_i)
Cancer_i = Cancer_i_2
col = colnames(Cancer_i)
col = sapply(strsplit(col,"\\|"),FUN = function(x){return(x[1])})
colnames(Cancer_i) = col
Cancer_i = log2(Cancer_i + 1)
GE = readRDS("Processed_data/S1/expresion_matrix.rds")
intersect_genes = intersect(colnames(GE),colnames(Cancer_i))
GE = GE[,intersect_genes]
Cancer_i = Cancer_i[,intersect_genes]
TT = c(TT,rep(i,nrow(Cancer_i)))
TCGA_GE = rbind(TCGA_GE,Cancer_i)
}
dim(TCGA_GE)
View(TCGA_GE)
TT = data.frame(TT)
View(TT)
rm(list=ls())
library("readxl")
# Read clinical data from table (2016-Ding)
setwd("~/Desktop/Cancer_DRP/R/Prepare_Data/")
N_Patients = readRDS("Processed_data/S21/Num_Patients_in_each_cancer.rds")
Response_table = read_excel("Raw_data/TCGA/2016-Ding/bioinfo16_supplementary_tables.xlsx",
sheet = 3,na = "---")
colnames(Response_table) = Response_table[2,]
Response_table = Response_table[c(-1,-2,-3),]
Response_table$drug_name = tolower(Response_table$drug_name)
Response_table = data.frame(Response_table)
View(Response_table)
Cancer_types = unique(Response_table$Cancer)
Cancer_types
Cancer = sapply(strsplit(Cancer_types,"\\("), FUN = function(x){return(x[2])})
Cancer = sapply(strsplit(Cancer,"\\)"), FUN = function(x){return(x[1])})
Cancer
S = c()
for(i in Cancer_types){
S = c(S,sum(Response_table$Cancer == i))
}
S
x = data.frame(c = Cancer,s = S)
View(x)
Cancer_type = data.frame(lapply(x, rep, x$s))
Cancer_type
Response_table$Cancer_type = Cancer_type[,1]
source("~/Desktop/Cancer_DRP/R/Prepare_Data/S21-Read_TCGA_RNAseq_GE.R")
View(TT)
i="ACC"
TCGA_GE = c()
TT = c()
print(i)
Cancer_i = get(i)
Cancer_i = Cancer_i[-2,]
patient_all = Cancer_i[1,]
patient_all = substr(Cancer_i[1,],1,12)
Cancer_i[1,] = patient_all
patient_with_response = Response_table[which(Response_table$Cancer_type == i),2]
Intersect = intersect(patient_all, patient_with_response)
patient_with_response = Response_table[Response_table$bcr_patient_barcode %in% Intersect,]
Cancer_i = Cancer_i[,c(1,which(patient_all %in% Intersect))]
dup = which(duplicated(as.character(Cancer_i[1,])))
dup = dup-1
dup
colnames(Cancer_i) = Cancer_i[1,]
Cancer_i = Cancer_i[-1,]
rownames(Cancer_i) = Cancer_i[,1]
Cancer_i = Cancer_i[,c(-1)]
Cancer_i = t(Cancer_i)
View(Cancer_i)
Cancer_i = get(i)
View(Cancer_i)
ACC = read.table("Raw_data/TCGA/RNAseq/ACC/ACC.rnaseqv2_RSEM_genes_normalized.txt",fill = TRUE, header=FALSE)
View(ACC)
ncol(ACC)-1
ACC = ACC[,ncol(ACC)-1]
print(i)
Cancer_i = get(i)
ACC = read.table("Raw_data/TCGA/RNAseq/ACC/ACC.rnaseqv2_RSEM_genes_normalized.txt",fill = TRUE, header=FALSE)
View(ACC)
ACC = ACC[,-ncol(ACC)-1]
View(ACC)
ACC = read.table("Raw_data/TCGA/RNAseq/ACC/ACC.rnaseqv2_RSEM_genes_normalized.txt",fill = TRUE, header=FALSE)
ACC = ACC[,-(ncol(ACC)-1)]
View(ACC)
View(ACC)
ncol(ACC)-1
ACC = read.table("Raw_data/TCGA/RNAseq/ACC/ACC.rnaseqv2_RSEM_genes_normalized.txt",fill = TRUE, header=FALSE)
ncol(ACC)-1
dim(ACC)
ACC = read.table("Raw_data/TCGA/RNAseq/ACC/ACC.rnaseqv2_RSEM_genes_normalized.txt",fill = TRUE, header=FALSE)
View(ACC)
ACC = ACC[,1:(ncol(ACC)-1)]
View(ACC)
ACC = read.table("Raw_data/TCGA/RNAseq/ACC/ACC.rnaseqv2_RSEM_genes_normalized.txt",fill = TRUE, header=FALSE)
View(ACC)
ACC = ACC[,1:(ncol(ACC)-1)]
View(ACC)
print(i)
Cancer_i = get(i)
Cancer_i = Cancer_i[-2,]
patient_all = Cancer_i[1,]
patient_all = substr(Cancer_i[1,],1,12)
Cancer_i[1,] = patient_all
View(Cancer_i)
patient_with_response = Response_table[which(Response_table$Cancer_type == i),2]
patient_with_response
Intersect = intersect(patient_all, patient_with_response)
patient_with_response = Response_table[Response_table$bcr_patient_barcode %in% Intersect,]
View(patient_with_response)
Cancer_i = Cancer_i[,c(1,which(patient_all %in% Intersect))]
View(Cancer_i)
dup = which(duplicated(as.character(Cancer_i[1,])))
dup = dup-1
dup
dup = which(duplicated(as.character(Cancer_i[1,])))
dup
dup = dup-1
dup
colnames(Cancer_i) = Cancer_i[1,]
Cancer_i = Cancer_i[-1,]
rownames(Cancer_i) = Cancer_i[,1]
Cancer_i = Cancer_i[,c(-1)]
Cancer_i = t(Cancer_i)
#B = data.frame((rownames(Cancer_i)))
Cancer_i_2 = apply(Cancer_i,2,as.numeric)
for (k in dup){
rep = apply(Cancer_i_2[c(k-1,k),],2,mean)
Cancer_i_2[k-1,] = rep
}
View(Cancer_i_2)
dup
k
Cancer_i_2 = Cancer_i_2[-dup,]
print(i)
Cancer_i = get(i)
Cancer_i = Cancer_i[-2,]
patient_all = Cancer_i[1,]
patient_all = substr(Cancer_i[1,],1,12)
Cancer_i[1,] = patient_all
patient_with_response = Response_table[which(Response_table$Cancer_type == i),2]
Intersect = intersect(patient_all, patient_with_response)
patient_with_response = Response_table[Response_table$bcr_patient_barcode %in% Intersect,]
Cancer_i = Cancer_i[,c(1,which(patient_all %in% Intersect))]
dup = which(duplicated(as.character(Cancer_i[1,])))
dup = dup-1
colnames(Cancer_i) = Cancer_i[1,]
Cancer_i = Cancer_i[-1,]
rownames(Cancer_i) = Cancer_i[,1]
Cancer_i = Cancer_i[,c(-1)]
Cancer_i = t(Cancer_i)
#B = data.frame((rownames(Cancer_i)))
Cancer_i = apply(Cancer_i,2,as.numeric)
print(i)
Cancer_i = get(i)
Cancer_i = Cancer_i[-2,]
patient_all = Cancer_i[1,]
patient_all = substr(Cancer_i[1,],1,12)
Cancer_i[1,] = patient_all
patient_with_response = Response_table[which(Response_table$Cancer_type == i),2]
Intersect = intersect(patient_all, patient_with_response)
patient_with_response = Response_table[Response_table$bcr_patient_barcode %in% Intersect,]
Cancer_i = Cancer_i[,c(1,which(patient_all %in% Intersect))]
dup = which(duplicated(as.character(Cancer_i[1,])))
dup = dup-1
colnames(Cancer_i) = Cancer_i[1,]
Cancer_i = Cancer_i[-1,]
rownames(Cancer_i) = Cancer_i[,1]
Cancer_i = Cancer_i[,c(-1)]
Cancer_i = t(Cancer_i)
#B = data.frame((rownames(Cancer_i)))
Cancer_i_2 = apply(Cancer_i,2,as.numeric)
if(dup>0){
for (k in dup){
rep = apply(Cancer_i_2[c(k-1,k),],2,mean)
Cancer_i_2[k-1,] = rep
}
Cancer_i_2 = Cancer_i_2[-dup,]
Cancer_i = Cancer_i[-dup,]
}
dup>0
dup
dup!=0
dup = which(duplicated(as.character(Cancer_i[1,])))
dup
print(i)
Cancer_i = get(i)
Cancer_i = Cancer_i[-2,]
patient_all = Cancer_i[1,]
patient_all = substr(Cancer_i[1,],1,12)
Cancer_i[1,] = patient_all
patient_with_response = Response_table[which(Response_table$Cancer_type == i),2]
Intersect = intersect(patient_all, patient_with_response)
patient_with_response = Response_table[Response_table$bcr_patient_barcode %in% Intersect,]
Cancer_i = Cancer_i[,c(1,which(patient_all %in% Intersect))]
dup = which(duplicated(as.character(Cancer_i[1,])))
dup
dup > 0
if(dup > 0){
dup = dup-1
for (k in dup){
rep = apply(Cancer_i_2[c(k-1,k),],2,mean)
Cancer_i_2[k-1,] = rep
}
Cancer_i_2 = Cancer_i_2[-dup,]
Cancer_i = Cancer_i[-dup,]
}
length(dup)==0
if(length(dup)==0){
dup = dup-1
for (k in dup){
rep = apply(Cancer_i_2[c(k-1,k),],2,mean)
Cancer_i_2[k-1,] = rep
}
Cancer_i_2 = Cancer_i_2[-dup,]
Cancer_i = Cancer_i[-dup,]
}
length(dup)>0
print(i)
Cancer_i = get(i)
Cancer_i = Cancer_i[-2,]
patient_all = Cancer_i[1,]
patient_all = substr(Cancer_i[1,],1,12)
Cancer_i[1,] = patient_all
patient_with_response = Response_table[which(Response_table$Cancer_type == i),2]
Intersect = intersect(patient_all, patient_with_response)
patient_with_response = Response_table[Response_table$bcr_patient_barcode %in% Intersect,]
Cancer_i = Cancer_i[,c(1,which(patient_all %in% Intersect))]
dup = which(duplicated(as.character(Cancer_i[1,])))
colnames(Cancer_i) = Cancer_i[1,]
Cancer_i = Cancer_i[-1,]
rownames(Cancer_i) = Cancer_i[,1]
Cancer_i = Cancer_i[,c(-1)]
Cancer_i = t(Cancer_i)
#B = data.frame((rownames(Cancer_i)))
Cancer_i_2 = apply(Cancer_i,2,as.numeric)
if(length(dup)>0){
dup = dup-1
for (k in dup){
rep = apply(Cancer_i_2[c(k-1,k),],2,mean)
Cancer_i_2[k-1,] = rep
}
Cancer_i_2 = Cancer_i_2[-dup,]
Cancer_i = Cancer_i[-dup,]
}
View(Cancer_i)
rownames(Cancer_i_2) = rownames(Cancer_i)
colnames(Cancer_i_2) = colnames(Cancer_i)
Cancer_i = Cancer_i_2
col = colnames(Cancer_i)
col = sapply(strsplit(col,"\\|"),FUN = function(x){return(x[1])})
colnames(Cancer_i) = col
Cancer_i = log2(Cancer_i + 1)
GE = readRDS("Processed_data/S1/expresion_matrix.rds")
intersect_genes = intersect(colnames(GE),colnames(Cancer_i))
GE = GE[,intersect_genes]
Cancer_i = Cancer_i[,intersect_genes]
TT = c(TT,rep(i,nrow(Cancer_i)))
TT
source("~/Desktop/Cancer_DRP/R/Prepare_Data/S21-Read_TCGA_RNAseq_GE.R")
View(TT)
dim(TCGA_GE)
unique(TT[,1]
unique(TT[,1])
unique(TT[,1])
u = "ACC"
TT$TT %in% u
sum[TT$TT %in% u]
TT$TT %in% u
sum(TT$TT %in% u)
N_TT = c()
for(u in 1:unique(TT[,1])){
N_TT = c(N_TT, sum(TT$TT %in% u))
}
unique(TT[,1])
N_TT = c()
for(u in unique(TT[,1])){
N_TT = c(N_TT, sum(TT$TT %in% u))
}
N_TT
Number_of_each_Cancer = cbind(unique(TT[,1]),N_TT)
View(Number_of_each_Cancer)
View(Response_table)
View(Number_of_each_Cancer)
